<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ç”Ÿæ—¥å¿«ä¹</title>
<style>
body{
  margin:0;
  overflow:hidden;
  background:black;
  touch-action:none;
  user-select:none;
  font-family:"PingFang SC",Arial,sans-serif;
}
canvas{display:block}


#startScreen{
  position:absolute;
  top:50%;left:50%;
  transform:translate(-50%,-50%);
  font-size:4.2em;
  color:white;
  text-align:center;
  cursor:pointer;
  z-index:5;
  animation:bounce 1.1s infinite alternate;
  text-shadow:0 0 14px hotpink;
}
@keyframes bounce{
  from{transform:translate(-50%,-50%) scale(1)}
  to{transform:translate(-50%,-60%) scale(1.12)}
}

/* ç”Ÿæ—¥å¿«ä¹ */
#finalMessage{
  position:absolute;
  top:45%;left:50%;
  transform:translate(-50%,-50%);
  font-size:2.4em;
  font-weight:600;
  background:linear-gradient(90deg,#ffb7b2,#ff9aa2,#f6c1ff);
  -webkit-background-clip:text;
  color:transparent;
  opacity:0;
  z-index:3;
  white-space:nowrap;
  animation:fadeIn 3.5s ease forwards;
  animation-play-state:paused;
}
@keyframes fadeIn{
  from{opacity:0;filter:blur(4px)}
  to{opacity:1;filter:blur(0)}
}
</style>
</head>
<body>

<div id="startScreen">ğŸ‘†</div>
<div id="finalMessage">ğŸ‰ ç”Ÿæ—¥å¿«ä¹ ğŸ‰</div>
<canvas id="canvas"></canvas>

<script>
/* ================= é…ç½® ================= */
const NAME="ç»šä¸½";
const MAX_PARTICLES=3000;
const COLORS=["#ff9aa2","#ffb7b2","#ffdac1","#b5ead7","#c7ceea","#f6c1ff"];

/* ================= Web Audio API éŸ³ä¹ ================= */
let audioCtx, gainNode, isPlaying=false;

const melody = [
  {note: 264, duration:0.4},{note: 264, duration:0.4},{note: 297, duration:0.8},{note: 264, duration:0.8},{note: 352, duration:0.8},{note: 330, duration:1.2},
  {note: 264, duration:0.4},{note: 264, duration:0.4},{note: 297, duration:0.8},{note: 264, duration:0.8},{note: 396, duration:0.8},{note: 352, duration:1.2},
  {note: 264, duration:0.4},{note: 264, duration:0.4},{note: 528, duration:0.8},{note: 440, duration:0.8},{note: 352, duration:0.8},{note: 330, duration:0.8},{note: 297, duration:1.2},
  {note: 466, duration:0.4},{note: 466, duration:0.4},{note: 440, duration:0.8},{note: 352, duration:0.8},{note: 396, duration:0.8},{note: 352, duration:1.2}
];

function playMelody(){
  if(!audioCtx){
    audioCtx = new (window.AudioContext||window.webkitAudioContext)();
    gainNode = audioCtx.createGain();
    gainNode.gain.value = 0.15;
    gainNode.connect(audioCtx.destination);
  }

  let startTime = audioCtx.currentTime;
  melody.forEach(m=>{
    const osc = audioCtx.createOscillator();
    osc.frequency.value = m.note;
    osc.type = "sine";
    osc.connect(gainNode);
    osc.start(startTime);
    osc.stop(startTime + m.duration);
    startTime += m.duration;
  });

  setTimeout(()=>{ if(isPlaying) playMelody(); }, melody.reduce((sum,m)=>sum+m.duration,0)*1000);
}

/* ================= Canvas ================= */
const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");
canvas.width=innerWidth;
canvas.height=innerHeight;

let particles=[];
let started=false;
let messageShown=false; 

/* ================= ç²’å­ ================= */
class Particle{
  constructor(x,y,vx,vy,color,life=1.3,gravity=0){
    this.x=x;this.y=y;
    this.vx=vx;this.vy=vy;
    this.alpha=life;
    this.color=color;
    this.gravity=gravity;
  }
  update(){
    this.x+=this.vx;
    this.y+=this.vy;
    this.vy+=this.gravity;
    this.alpha-=0.01;
  }
  draw(){
    ctx.globalAlpha=Math.max(this.alpha,0);
    ctx.fillStyle=this.color;
    ctx.beginPath();
    ctx.arc(this.x,this.y,1.6,0,Math.PI*2);
    ctx.fill();
  }
}

/* ================= çƒŸèŠ± ================= */
function randomFirework(x,y){
  if(particles.length>MAX_PARTICLES) return;
  x??=Math.random()*canvas.width;
  y??=Math.random()*canvas.height*0.65;
  const color=COLORS[Math.floor(Math.random()*COLORS.length)];
  for(let i=0;i<26;i++){
    particles.push(new Particle(
      x,y,
      (Math.random()-0.5)*4,
      (Math.random()-0.5)*4,
      color,
      1.1,
      0.02
    ));
  }
}

/* ğŸ’– å¿ƒ */
function heartWithName(cx,cy){
  for(let t=0;t<Math.PI*2;t+=0.1){
    const x=16*Math.sin(t)**3;
    const y=-(13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t));
    particles.push(new Particle(cx,cy,x*0.14,y*0.14,"#ff9aa2",1.4,0));
  }

  const temp=document.createElement("canvas");
  temp.width=220;temp.height=90;
  const tctx=temp.getContext("2d");
  tctx.font="bold 36px Arial";
  tctx.fillStyle="white";
  tctx.textAlign="center";
  tctx.textBaseline="middle";
  tctx.fillText(NAME,110,45);

  const d=tctx.getImageData(0,0,220,90).data;
  for(let y=0;y<90;y+=3){
    for(let x=0;x<220;x+=3){
      if(d[(y*220+x)*4+3]>150){
        particles.push(new Particle(
          cx+x-110,
          cy+y-45,
          (Math.random()-0.5)*0.08,
          (Math.random()-0.5)*0.08,
          "#ffe3ec",
          1.8,
          0
        ));
      }
    }
  }
}

/* ğŸ‚ è›‹ç³• */
function cakeFirework(cx, cy){
  let layerHeight = 20;
  let bottomWidth = 80, middleWidth = 60, topWidth = 40;

  function drawLayer(width, yOffset, color){
    for(let y=0;y<layerHeight;y++){
      for(let x=-width/2;x<=width/2;x+=3){
        let offsetX = x + (Math.random()-0.5)*4;
        let offsetY = cy + yOffset + y + (Math.random()-0.5)*2;
        particles.push(new Particle(cx+offsetX, offsetY, 0,0,color,1.5,0));
      }
    }
  }

  drawLayer(bottomWidth,0,"#ff9aa2");
  drawLayer(middleWidth,-layerHeight,"#ffdac1");
  drawLayer(topWidth,-2*layerHeight,"#ffe3ec");

  // å¥¶æ²¹æ³¢çº¹è£…é¥°
  for(let i=0;i<50;i++){
    let px = cx + (Math.random()-0.5)*topWidth;
    let py = cy - 2*layerHeight - 3 + Math.sin(i/5)*2 + (Math.random()-0.5)*2;
    let c = i%2===0?"#fff5f5":"#ffe3f0";
    particles.push(new Particle(px,py,0,0,c,1.5,0));
  }

  // èœ¡çƒ›ä¸ç«ç„°
  let candleCount=5;
  let topY = cy - 3*layerHeight;
  for(let c=0;c<candleCount;c++){
    let candleX = cx - topWidth/2 + c*(topWidth/(candleCount-1));
    for(let h=0;h<12;h++){
      let px = candleX + (Math.random()-0.5)*1;
      let py = topY - h;
      particles.push(new Particle(px,py,0,0,"#ffd700",1.5,0));
    }
    // ç«ç„°
    for(let f=0;f<10;f++){
      let fx = candleX + (Math.random()-0.5)*1.5 + Math.sin(f/2)*0.5;
      let fy = topY - 12 - f*1.2;
      let color = f%2===0 ? "#ff9a00" : "#ffcc00";
      particles.push(new Particle(fx,fy,(Math.random()-0.5)*0.2, -0.6-f*0.02,color,1.2,0.01));
    }
  }
}

/* ================= åŠ¨ç”» ================= */
function animate(){
  ctx.fillStyle="rgba(0,0,0,0.18)";
  ctx.fillRect(0,0,canvas.width,canvas.height);
  for(let i=particles.length-1;i>=0;i--){
    const p=particles[i];
    p.update();p.draw();
    if(p.alpha<=0) particles.splice(i,1);
  }
  requestAnimationFrame(animate);
}
animate();

/* ================= å¯åŠ¨ ================= */
document.getElementById("startScreen").onclick = ()=>{
  document.getElementById("startScreen").style.display="none";
  started=true;
  isPlaying = true;
  playMelody(); // ğŸµ 

  randomFirework(canvas.width/2,canvas.height/2);
  setInterval(randomFirework,520);

  setTimeout(()=>{
    const msg=document.getElementById("finalMessage");
    msg.style.display="block";
    msg.style.animationPlayState="running";
    messageShown=true;
  },7000);
};

/* ================= å•/åŒå‡»äº¤äº’ ================= */
let clickTimer=null;
canvas.addEventListener("click",e=>{
  if(!started||!messageShown) return;
  if(clickTimer){
    clearTimeout(clickTimer);
    clickTimer=null;
    cakeFirework(e.clientX,e.clientY);
  }else{
    clickTimer=setTimeout(()=>{
      heartWithName(e.clientX,e.clientY);
      clickTimer=null;
    },350);
  }
});

onresize=()=>{
  canvas.width=innerWidth;
  canvas.height=innerHeight;
};
</script>
</body>
</html>
