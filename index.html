<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>ç”Ÿæ—¥å¿«ä¹</title>

<style>
body{
  margin:0;
  overflow:hidden;
  background:black;
  touch-action:none;
  user-select:none;
  font-family:"PingFang SC",Arial,sans-serif;
}
canvas{display:block}

/* ğŸ‘† å¼€å§‹ */
#startScreen{
  position:absolute;
  top:50%;left:50%;
  transform:translate(-50%,-50%);
  font-size:4.2em;
  color:white;
  cursor:pointer;
  z-index:5;
  animation:bounce 1.1s infinite alternate;
  text-shadow:0 0 14px hotpink;
}
@keyframes bounce{
  from{transform:translate(-50%,-50%) scale(1)}
  to{transform:translate(-50%,-60%) scale(1.12)}
}

/* ğŸ‰ æ–‡æ¡ˆ */
#finalMessage{
  position:absolute;
  top:45%;left:50%;
  transform:translate(-50%,-50%);
  font-size:2.4em;
  font-weight:600;
  background:linear-gradient(90deg,#ffb7b2,#ff9aa2,#f6c1ff);
  -webkit-background-clip:text;
  color:transparent;
  opacity:0;
  z-index:3;
  white-space:nowrap;
  animation:fadeIn 3.5s ease forwards;
  animation-play-state:paused;
}
@keyframes fadeIn{
  from{opacity:0;filter:blur(4px)}
  to{opacity:1;filter:blur(0)}
}
</style>
</head>

<body>

<div id="startScreen">ğŸ‘†</div>
<div id="finalMessage">ğŸ‰ ç”Ÿæ—¥å¿«ä¹ ğŸ‰</div>
<canvas id="canvas"></canvas>

<script>
/* ===================================================
   ğŸµ å¾®ä¿¡å¯æ’­æ”¾ Â· ç”Ÿæ—¥æ­Œï¼ˆWeb Audioï¼‰
   =================================================== */

let audioCtx;
let isMusicPlaying = false;
let currentOscillators = [];

function playBirthdaySong(){
  if(isMusicPlaying) return;
  isMusicPlaying = true;

  audioCtx = new (window.AudioContext || window.webkitAudioContext)();

  const tempo = 0.9; // â­ æ”¾æ…¢èŠ‚å¥
  const notes = [
    264,264,297,264,352,330,
    264,264,297,264,396,352,
    264,264,528,440,352,330,297,
    466,466,440,352,396,352
  ];

  let time = audioCtx.currentTime;

  function playLoop(){
    notes.forEach(freq=>{
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();

      osc.type = "sine";
      osc.frequency.value = freq;
      gain.gain.setValueAtTime(0.12, time);
      gain.gain.exponentialRampToValueAtTime(0.001, time + 0.45 * tempo);

      osc.connect(gain).connect(audioCtx.destination);
      osc.start(time);
      osc.stop(time + 0.5 * tempo);

      time += 0.55 * tempo;
    });

    // å¾ªç¯
    setTimeout(playLoop, notes.length * 550 * tempo);
  }

  playLoop();
}

/* ===================================================
   ğŸ”“ å¾®ä¿¡éŸ³é¢‘è§£é”ï¼ˆå…³é”®ï¼‰
   =================================================== */
function unlockAudio(){
  if(audioCtx) return;
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  audioCtx.resume();
}

/* å¾®ä¿¡æ¡¥æ¥ */
document.addEventListener("WeixinJSBridgeReady", unlockAudio, false);

/* ===================================================
   ä½ åŸæœ¬çš„çƒŸèŠ±é€»è¾‘ï¼ˆä¿æŒä¸åŠ¨ï¼‰
   =================================================== */

const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");
canvas.width=innerWidth;
canvas.height=innerHeight;

let particles=[];
class Particle{
  constructor(x,y,vx,vy,color){
    this.x=x;this.y=y;
    this.vx=vx;this.vy=vy;
    this.alpha=1;
    this.color=color;
  }
  update(){
    this.x+=this.vx;
    this.y+=this.vy;
    this.alpha-=0.01;
  }
  draw(){
    ctx.globalAlpha=this.alpha;
    ctx.fillStyle=this.color;
    ctx.beginPath();
    ctx.arc(this.x,this.y,1.6,0,Math.PI*2);
    ctx.fill();
  }
}

function randomFirework(x,y){
  const colors=["#ff9aa2","#ffb7b2","#ffdac1","#b5ead7","#c7ceea"];
  const color=colors[Math.floor(Math.random()*colors.length)];
  for(let i=0;i<26;i++){
    particles.push(new Particle(
      x,y,
      (Math.random()-0.5)*4,
      (Math.random()-0.5)*4,
      color
    ));
  }
}

function animate(){
  ctx.fillStyle="rgba(0,0,0,0.18)";
  ctx.fillRect(0,0,canvas.width,canvas.height);
  for(let i=particles.length-1;i>=0;i--){
    const p=particles[i];
    p.update();p.draw();
    if(p.alpha<=0) particles.splice(i,1);
  }
  requestAnimationFrame(animate);
}
animate();

/* ===================================================
   â–¶ ç‚¹å‡»å¼€å§‹ï¼ˆå”¯ä¸€å…¥å£ï¼‰
   =================================================== */
document.getElementById("startScreen").onclick=()=>{
  document.getElementById("startScreen").style.display="none";

  unlockAudio();          // ğŸ”“ è§£é”
  playBirthdaySong();     // ğŸµ ç‚¹å‡»åæ’­æ”¾ï¼ˆå¾®ä¿¡å…è®¸ï¼‰

  randomFirework(canvas.width/2,canvas.height/2);
  setInterval(()=>randomFirework(
    Math.random()*canvas.width,
    Math.random()*canvas.height*0.6
  ),520);

  setTimeout(()=>{
    const msg=document.getElementById("finalMessage");
    msg.style.display="block";
    msg.style.animationPlayState="running";
  },7000);
};

onresize=()=>{
  canvas.width=innerWidth;
  canvas.height=innerHeight;
};
</script>

</body>
</html>
