<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>ç”Ÿæ—¥å¿«ä¹</title>

<style>
body{
  margin:0;
  overflow:hidden;
  background:black;
  touch-action:none;
  user-select:none;
  font-family:"PingFang SC",Arial,sans-serif;
}
canvas{display:block}

/* ğŸ‘† å¼€å§‹ */
#startScreen{
  position:absolute;
  top:50%;left:50%;
  transform:translate(-50%,-50%);
  font-size:4.2em;
  color:white;
  cursor:pointer;
  z-index:5;
  animation:bounce 1.1s infinite alternate;
  text-shadow:0 0 14px hotpink;
}
@keyframes bounce{
  from{transform:translate(-50%,-50%) scale(1)}
  to{transform:translate(-50%,-60%) scale(1.12)}
}

/* ğŸ‰ æ–‡æ¡ˆ */
#finalMessage{
  position:absolute;
  top:45%;left:50%;
  transform:translate(-50%,-50%);
  font-size:2.4em;
  font-weight:600;
  background:linear-gradient(90deg,#ffb7b2,#ff9aa2,#f6c1ff);
  -webkit-background-clip:text;
  color:transparent;
  opacity:0;
  z-index:3;
  white-space:nowrap;
  animation:fadeIn 3.5s ease forwards;
  animation-play-state:paused;
}
@keyframes fadeIn{
  from{opacity:0;filter:blur(4px)}
  to{opacity:1;filter:blur(0)}
}
</style>
</head>

<body>

<div id="startScreen">ğŸ‘†</div>
<div id="finalMessage">ğŸ‰ ç”Ÿæ—¥å¿«ä¹ ğŸ‰</div>
<canvas id="canvas"></canvas>

<script>
/* ================== çƒŸèŠ±éƒ¨åˆ†ï¼ˆä¿æŒä¸å˜ï¼‰ ================== */
const NAME="ç»šä¸½";
const MAX_PARTICLES=2400;
const COLORS=["#ff9aa2","#ffb7b2","#ffdac1","#e2f0cb","#b5ead7","#c7ceea","#f6c1ff"];

const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");
canvas.width=innerWidth;
canvas.height=innerHeight;

let particles=[],started=false,messageShown=false;

class Particle{
  constructor(x,y,vx,vy,color,life=1.2,gravity=0.01){
    this.x=x;this.y=y;this.vx=vx;this.vy=vy;
    this.alpha=life;this.color=color;this.gravity=gravity;
  }
  update(){
    this.x+=this.vx; this.y+=this.vy;
    this.vy+=this.gravity; this.alpha-=0.008;
  }
  draw(){
    ctx.globalAlpha=Math.max(this.alpha,0);
    ctx.fillStyle=this.color;
    ctx.beginPath();
    ctx.arc(this.x,this.y,1.6,0,Math.PI*2);
    ctx.fill();
  }
}

function randomFirework(x,y){
  if(particles.length>MAX_PARTICLES) return;
  x??=Math.random()*canvas.width;
  y??=Math.random()*canvas.height*0.65;
  const color=COLORS[Math.floor(Math.random()*COLORS.length)];
  for(let i=0;i<28;i++){
    particles.push(new Particle(x,y,(Math.random()-0.5)*4,(Math.random()-0.5)*4,color));
  }
}

function heartWithName(cx,cy){
  for(let t=0;t<Math.PI*2;t+=0.1){
    const x=16*Math.pow(Math.sin(t),3);
    const y=-(13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t));
    particles.push(new Particle(cx,cy,x*0.14,y*0.14,"#ff9aa2",1.4,0));
  }

  const temp=document.createElement("canvas");
  temp.width=220; temp.height=90;
  const tctx=temp.getContext("2d");
  tctx.font="bold 36px Arial";
  tctx.fillStyle="white";
  tctx.textAlign="center";
  tctx.textBaseline="middle";
  tctx.fillText(NAME,110,45);
  const d=tctx.getImageData(0,0,220,90).data;

  for(let y=0;y<90;y+=3){
    for(let x=0;x<220;x+=3){
      if(d[(y*220+x)*4+3]>150){
        particles.push(new Particle(cx+x-110,cy+y-45,(Math.random()-0.5)*0.1,(Math.random()-0.5)*0.1,"#ffe3ec",1.8,0));
      }
    }
  }
}

function cakeFirework(cx,cy){
  for(let layer=0;layer<3;layer++){
    for(let x=-28;x<=28;x+=4){
      particles.push(new Particle(cx+x,cy-layer*14,(Math.random()-0.5)*0.8,-Math.random()*1.2,"#ffdac1",1.2,0));
    }
  }
}

function animate(){
  ctx.fillStyle="rgba(0,0,0,0.18)";
  ctx.fillRect(0,0,canvas.width,canvas.height);
  for(let i=particles.length-1;i>=0;i--){
    const p=particles[i]; p.update(); p.draw();
    if(p.alpha<=0) particles.splice(i,1);
  }
  requestAnimationFrame(animate);
}
animate();

/* ================== ğŸµ ç”Ÿæ—¥æ­Œï¼ˆå¾®ä¿¡å¯ç”¨ï¼Œæ…¢èŠ‚å¥ï¼Œä¼˜åŒ–å¾ªç¯å’Œå…¼å®¹æ€§ï¼‰ ================== */
let audioCtx=null, musicStarted=false;

// ğŸŒŸ ä¼˜åŒ–ï¼šå®‰å…¨åœ°åˆ›å»º AudioContextï¼Œå¤„ç†ç§»åŠ¨ç«¯é™åˆ¶
function initAudioContext() {
    if (audioCtx) return true;
    try {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        return true;
    } catch (e) {
        return false;
    }
}

function playBirthdaySong(){
  if(musicStarted) return;
  if (!initAudioContext()) return; // ç¡®ä¿åœ¨ç”¨æˆ·ç‚¹å‡»æ—¶åˆå§‹åŒ–
  
  musicStarted=true;

  const notes=[
    264,264,297,264,352,330,
    264,264,297,264,396,352,
    264,264,528,440,352,330,297,
    466,466,440,352,396,352
  ];

  let index=0;
  const tempo=650; // â­ æ…¢èŠ‚å¥ï¼ˆå…³é”®ï¼Œä¿æŒä¸å˜ï¼‰

  function playNote(){
    // ğŸŒŸ ä¼˜åŒ–ï¼šæ£€æŸ¥å¹¶æ¢å¤ AudioContext çŠ¶æ€ï¼Œç¡®ä¿åœ¨ç§»åŠ¨ç«¯ä¸ä¼šæš‚åœ
    if (audioCtx.state === 'suspended') {
        audioCtx.resume();
    }
    
    const osc=audioCtx.createOscillator();
    const gain=audioCtx.createGain();
    osc.type="sine";
    osc.frequency.value=notes[index];
    gain.gain.value=0.12;
    osc.connect(gain).connect(audioCtx.destination);
    
    const startTime = audioCtx.currentTime;
    osc.start(startTime);
    osc.stop(startTime + 0.55); // ä½¿ç”¨ç›¸å¯¹æ—¶é—´

    index=(index+1)%notes.length; // ç¡®ä¿å¾ªç¯
    setTimeout(playNote,tempo);
  }
  playNote();
}

/* ================== å¯åŠ¨ï¼ˆå…³é”®ï¼šç‚¹å‡»è§¦å‘éŸ³ä¹ï¼‰ ================== */
document.getElementById("startScreen").onclick=()=>{
  document.getElementById("startScreen").style.display="none";
  started=true;

  playBirthdaySong(); // â­â­â­ å¿…é¡»åœ¨ç‚¹å‡»é‡Œ

  randomFirework(canvas.width/2,canvas.height/2);
  setInterval(randomFirework,520);

  setTimeout(()=>{
    const msg=document.getElementById("finalMessage");
    msg.style.display="block";
    msg.style.animationPlayState="running";
    messageShown=true;
  },7000);
};

/* ================== äº¤äº’ ================== */
let lastTap=0;
canvas.addEventListener("pointerdown",e=>{
  if(!started||!messageShown) return;
  const now=Date.now();
  if(now-lastTap<300){
    cakeFirework(e.clientX,e.clientY);
  }else{
    heartWithName(e.clientX,e.clientY);
  }
  lastTap=now;
});

onresize=()=>{
  canvas.width=innerWidth;
  canvas.height=innerHeight;
};
</script>

</body>
</html>


</body>
</html>
