<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>ç”Ÿæ—¥å¿«ä¹</title>

<style>
body{
  margin:0;
  overflow:hidden;
  background:black;
  touch-action:none;
  user-select:none;
  font-family:"PingFang SC",Arial,sans-serif;
}
canvas{display:block}

/* å¼€å§‹æ‰‹åŠ¿ */
#startScreen{
  position:absolute;
  top:50%;left:50%;
  transform:translate(-50%,-50%);
  font-size:4.2em;
  color:white;
  text-align:center;
  cursor:pointer;
  z-index:5;
  animation:bounce 1.1s infinite alternate;
  text-shadow:0 0 14px hotpink;
}
@keyframes bounce{
  from{transform:translate(-50%,-50%) scale(1)}
  to{transform:translate(-50%,-60%) scale(1.12)}
}

/* ç”Ÿæ—¥å¿«ä¹ï¼ˆæ¸æ˜¾ï¼‰ */
#finalMessage{
  position:absolute;
  top:45%;left:50%;
  transform:translate(-50%,-50%);
  font-size:2.4em;
  font-weight:600;
  background:linear-gradient(90deg,#ffb7b2,#ff9aa2,#f6c1ff);
  -webkit-background-clip:text;
  color:transparent;
  opacity:0;
  z-index:3;
  white-space:nowrap;
  animation:fadeIn 3.5s ease forwards;
  animation-play-state:paused;
}
@keyframes fadeIn{
  from{opacity:0;filter:blur(4px)}
  to{opacity:1;filter:blur(0)}
}
</style>
</head>

<body>

<div id="startScreen">ğŸ‘†</div>
<div id="finalMessage">ğŸ‰ ç”Ÿæ—¥å¿«ä¹ ğŸ‰</div>
<canvas id="canvas"></canvas>

<script>
/* ================== ğŸµ å¾®ä¿¡å¯æ’­æ”¾çš„ç”Ÿæ—¥æ­Œ ================== */
let audioCtx;
let musicStarted = false;
let musicTimer = null;

function initAudio() {
  if (musicStarted) return;
  musicStarted = true;

  audioCtx = new (window.AudioContext || window.webkitAudioContext)();

  playBirthdaySong();
}

/* ğŸ¶ ç”Ÿæ—¥å¿«ä¹æ—‹å¾‹ï¼ˆç®€åŒ–ä½†å¥½å¬ï¼‰ */
const melody = [
  [264, 500], [264, 500], [297, 1000], [264, 1000], [352, 1000], [330, 2000],
  [264, 500], [264, 500], [297, 1000], [264, 1000], [396, 1000], [352, 2000],
  [264, 500], [264, 500], [528, 1000], [440, 1000], [352, 1000], [330, 1000], [297, 2000],
  [466, 500], [466, 500], [440, 1000], [352, 1000], [396, 1000], [352, 3000]
];

function playBirthdaySong() {
  let time = audioCtx.currentTime;

  melody.forEach(([freq, dur]) => {
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();

    osc.type = "sine";
    osc.frequency.value = freq;

    gain.gain.setValueAtTime(0.0001, time);
    gain.gain.exponentialRampToValueAtTime(0.2, time + 0.05);
    gain.gain.exponentialRampToValueAtTime(0.0001, time + dur / 1000);

    osc.connect(gain);
    gain.connect(audioCtx.destination);

    osc.start(time);
    osc.stop(time + dur / 1000);

    time += dur / 1000;
  });

  // â­ è‡ªåŠ¨å¾ªç¯
  clearTimeout(musicTimer);
  musicTimer = setTimeout(playBirthdaySong, (time - audioCtx.currentTime) * 1000);
}

/* ================== ğŸ”‘ å¾®ä¿¡è§£é”éŸ³é¢‘ ================== */
document.addEventListener("WeixinJSBridgeReady", () => {
  if (audioCtx && audioCtx.state !== "running") {
    audioCtx.resume();
  }
}, false);

/* ================== ğŸ‘† ç‚¹å‡»å¼€å§‹æ—¶åˆå§‹åŒ– ================== */
document.getElementById("startScreen").addEventListener("click", () => {
  initAudio();
});
</script>

</body>
</html>
